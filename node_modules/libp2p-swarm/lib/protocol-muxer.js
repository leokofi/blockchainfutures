'use strict';

var multistream = require('multistream-select');

module.exports = function protocolMuxer(protocols, conn) {
  var ms = new multistream.Listener();

  Object.keys(protocols).forEach(function (protocol) {
    if (!protocol) {
      return;
    }

    ms.addHandler(protocol, protocols[protocol]);
  });

  ms.handle(conn, function (err) {
    if (err) {
      return; // the multistream handshake failed
    }
  });
};