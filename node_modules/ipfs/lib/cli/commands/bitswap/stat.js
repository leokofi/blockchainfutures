'use strict';

var utils = require('../../utils');

module.exports = {
  command: 'stat',

  describe: 'Show some diagnostic information on the bitswap agent.',

  builder: {},

  handler: function handler() {
    utils.getIPFS(function (err, ipfs) {
      if (err) {
        throw err;
      }

      ipfs.bitswap.stat(function (err, stats) {
        if (err) {
          throw err;
        }

        stats.Wantlist = stats.Wantlist || [];
        stats.Peers = stats.Peers || [];

        console.log('bitswap status\n  blocks received: ' + stats.BlocksReceived + '\n  dup blocks received: ' + stats.DupBlksReceived + '\n  dup data received: ' + stats.DupDataReceived + 'B\n  wantlist [' + stats.Wantlist.length + ' keys]\n    ' + stats.Wantlist.join('\n    ') + '\n  partners [' + stats.Peers.length + ']\n    ' + stats.Peers.join('\n    '));
      });
    });
  }
};