'use strict';

var path = require('path');
var pull = require('pull-stream');

var fileExporter = require('./file');
var switchType = require('../util').switchType;

// Logic to export a unixfs directory.
module.exports = function (node, name, dagService) {
  return pull(pull.values(node.links), pull.map(function (link) {
    return {
      path: path.join(name, link.name),
      hash: link.hash
    };
  }), pull.map(function (item) {
    return pull(dagService.getStream(item.hash), pull.map(function (n) {
      return switchType(n, function () {
        return pull.values([item]);
      }, function () {
        return fileExporter(n, item.path, dagService);
      });
    }), pull.flatten());
  }), pull.flatten());
};