'use strict';

var UnixFS = require('ipfs-unixfs');
var pull = require('pull-stream');
var mh = require('multihashes');
var isIPFS = require('is-ipfs');

exports.switchType = function (node, dirHandler, fileHandler) {
  var data = UnixFS.unmarshal(node.data);
  var type = data.type;

  if (type === 'directory') return dirHandler();
  if (type === 'file') return fileHandler();

  return pull.error(new Error('Unkown node type'));
};

exports.cleanMultihash = function (multihash) {
  if (!isIPFS.multihash(multihash)) {
    throw new Error('not valid multihash');
  }

  if (Buffer.isBuffer(multihash)) {
    return mh.toB58String(multihash);
  }

  return multihash;
};